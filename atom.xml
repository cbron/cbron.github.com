<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Cable Codes]]></title>
  <link href="http://cbron.github.com/atom.xml" rel="self"/>
  <link href="http://cbron.github.com/"/>
  <updated>2014-07-03T10:16:15-07:00</updated>
  <id>http://cbron.github.com/</id>
  <author>
    <name><![CDATA[cbron]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Versioning a Flask-Restful api]]></title>
    <link href="http://cbron.github.com/blog/2014/07/03/versioning-a-flask-restful-api/"/>
    <updated>2014-07-03T09:04:00-07:00</updated>
    <id>http://cbron.github.com/blog/2014/07/03/versioning-a-flask-restful-api</id>
    <content type="html"><![CDATA[<p><em>Disclaimer</em>: This is not necessarily the <em>best</em> way to version an api through flask-restful, it is simply <em>one</em> way.</p>

<p>There doesn&#8217;t seem to be a standard way to do this in flask-restful. I would recommend watching this video to see how its done in ruby on rails, as you can almost re-create this in python: <a href="http://railscasts.com/episodes/350-rest-api-versioning">http://railscasts.com/episodes/350-rest-api-versioning</a></p>

<p>Project Structure</p>

<pre><code>repo
  |--app
    __init__.py
    urls.py
    |--common
        authentication.py
        utils.py
    |--models
        user.py
        article.py
    |--views
        |--v1
           users.py
           articles.py
        |--v2
           users.py
</code></pre>

<p>urls.py</p>

<pre><code>#V1

from views.v1.articles import Articles
from views.v1.users import UsersV1

api.add_resource(Articles, '/&lt;string:version&gt;/articles')
api.add_resource(UsersV1, '/v1/users')


# V2

from views.v2.users import UsersV2
api.add_resource(UsersV2, '/v2/users')
</code></pre>

<p>The benefit you get from doing it this way is that now you can hit <code>/v5/articles</code> and it will still go to the original articles.py view file. This means you don&#8217;t have to copy over articles.py to the v2 folder once you create it, you only have to create files for things that will change.</p>

<p>The downside is that you may have a <code>/v2</code> folder with updates to users, a <code>/v3</code> folder with updates to just articles and a <code>/v4</code> folder with just updates to a yet-to-be-created view. But thats what command+T is for in Sublime :) You&#8217;ll also have to rename your classes from <code>Users</code> to <code>UsersV1/UsersV2</code> everytime you switch from a single file to a versioned file.</p>

<p><em>P.S. For brevity I left most of the files out of the project structure, you will still need a <code>__init__.py</code> file in your views/, v1/, v2/, models/, etc.. folders</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[auto merge pull requests on github except the master branch]]></title>
    <link href="http://cbron.github.com/blog/2014/03/25/auto-merge-pull-requests-on-github-except-the-master-branch/"/>
    <updated>2014-03-25T08:39:00-07:00</updated>
    <id>http://cbron.github.com/blog/2014/03/25/auto-merge-pull-requests-on-github-except-the-master-branch</id>
    <content type="html"><![CDATA[<ul>
<li>Problem: You want to merge all pull requests from developers who don&#8217;t have push access (they can&#8217;t merge the PR themselves).</li>
<li>Stipulation: We probably shouldn&#8217;t do this on the master branch. Or staging for that matter.</li>
<li>Solution: Use the github api (v3)

<ul>
<li>1 - with a post-hook</li>
<li>2 - with a cron job</li>
</ul>
</li>
</ul>


<p>This script is solution 2. Its not as efficient (there is a time delay instead of it being instant), but I&#8217;m in an odd situation where I can&#8217;t publicly expose a page that would receive the post-hook. But using this same idea with a post-hook wouldn&#8217;t be too hard.</p>

<h3>The python (2.7) script</h3>

<p>I put this in /root/ so that non-sudo users can&#8217;t see the OAUTH_KEY, but you can place it anywhere.</p>

<p>The way its configured, it won&#8217;t merge INTO master, staging, release, or development. Although it could go from development into my-feature-1 or any other branch.</p>

<p>Make sure you change the two spots where it has :owner to your username</p>

<p>(Disclaimer: I&#8217;m still a Python newbie, so there could be bad practices in here.)</p>

<figure class='code'><figcaption><span>auto_merge_github.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">OAUTH_KEY</span> <span class="o">=</span> <span class="s">&quot;xxxxxxxxxxxx&quot;</span>
</span><span class='line'><span class="n">repos</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;my_app&#39;</span><span class="p">]</span> <span class="c"># Add all repo&#39;s you want to automerged here</span>
</span><span class='line'><span class="n">ignore_branches</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;master&#39;</span><span class="p">,</span> <span class="s">&#39;release&#39;</span><span class="p">,</span> <span class="s">&#39;staging&#39;</span><span class="p">,</span> <span class="s">&#39;development&#39;</span><span class="p">]</span> <span class="c"># Add &#39;master&#39; here if you don&#39;t want to automerge into master</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># Print merge/no-merge message to logfile</span>
</span><span class='line'><span class="k">def</span> <span class="nf">print_message</span><span class="p">(</span><span class="n">merging</span><span class="p">):</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">merging</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>    <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Merging: &quot;</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Not merging: &quot;</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">message</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pr_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; - &quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot; wants to merge &quot;</span> <span class="o">+</span> <span class="n">head_ref</span> <span class="o">+</span> <span class="s">&quot; into &quot;</span> <span class="o">+</span> <span class="n">base_ref</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># Merge the actual pull request</span>
</span><span class='line'><span class="k">def</span> <span class="nf">merge_pr</span><span class="p">():</span>
</span><span class='line'>  <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;https://api.github.com/repos/:owner/</span><span class="si">%s</span><span class="s">/pulls/</span><span class="si">%d</span><span class="s">/merge&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span><span class="n">pr_id</span><span class="p">,),</span>
</span><span class='line'>    <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&quot;commit_message&quot;</span><span class="p">:</span> <span class="s">&quot;Auto_Merge&quot;</span><span class="p">}),</span>
</span><span class='line'>    <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;token&#39;</span><span class="p">,</span> <span class="n">OAUTH_KEY</span><span class="p">))</span>
</span><span class='line'>  <span class="k">if</span> <span class="s">&quot;merged&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">&quot;merged&quot;</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Merged: &quot;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">&#39;sha&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Failed: &quot;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># Main</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">repo</span> <span class="ow">in</span> <span class="n">repos</span><span class="p">:</span>
</span><span class='line'>  <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;https://api.github.com/repos/:owner/</span><span class="si">%s</span><span class="s">/pulls&#39;</span><span class="o">%</span><span class="n">repo</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;token&#39;</span><span class="p">,</span> <span class="n">OAUTH_KEY</span><span class="p">))</span>
</span><span class='line'>  <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>    <span class="n">head_ref</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;head&quot;</span><span class="p">][</span><span class="s">&quot;ref&quot;</span><span class="p">]</span>
</span><span class='line'>    <span class="n">base_ref</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;base&quot;</span><span class="p">][</span><span class="s">&quot;ref&quot;</span><span class="p">]</span>
</span><span class='line'>    <span class="n">user</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">][</span><span class="s">&quot;login&quot;</span><span class="p">]</span>
</span><span class='line'>    <span class="n">pr_id</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&quot;number&quot;</span><span class="p">]</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">base_ref</span> <span class="ow">in</span> <span class="n">ignore_branches</span><span class="p">:</span>
</span><span class='line'>      <span class="n">print_message</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="n">print_message</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>      <span class="n">merge_pr</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the cron code that runs it every 5 minutes:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Auto merge github PR&#39;s</span>
</span><span class='line'>*/5 * * * * /usr/local/bin/python2.7 /root/auto_merge_github.py &gt;&gt; /root/auto_merge_github.log 2&gt;&amp;1
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[draw svg path on scroll tutorial]]></title>
    <link href="http://cbron.github.com/blog/2013/12/30/draw-svg-path-on-scroll-tutorial/"/>
    <updated>2013-12-30T12:40:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/12/30/draw-svg-path-on-scroll-tutorial</id>
    <content type="html"><![CDATA[<p>The &#8221;<a href="http://www.nytimes.com/newsgraphics/2013/10/13/russia/?ref=global-home">Russia Left Behind</a>&#8221; article caught my attention a few months ago and I fell in love with it, especially the two maps.
I will quickly go over one way to draw a line on user scroll, although this way is different from the way the New York Times did it. From the looks of it they used <a href="https://github.com/mbostock/topojson">TopoJSON</a>.</p>

<p><a href="http://www.calebbron.com/stuff/svg.html">Demo</a></p>

<p>There&#8217;s two pieces in building this line. First is creating the SVG and second is drawing it on an html page.</p>

<h3>SVG</h3>

<p>I used illustrator but I believe inkscape would work as well. All you need is the <code>&lt;svg&gt;</code> code. Inside Illustrator use the pen tool to draw a line or shape. The tough part is making sure that all the points stay part of a single path, which results in a single <code>&lt;svg&gt;</code> block. When your done hit &#8220;save as&#8221; and change the type to .svg then click save and click &#8220;Show SVG Code&#8221;, or just save it and open it in a code editor. You should be able to extract a single code block, mine looks like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;svg</span> <span class="na">version=</span><span class="s">&quot;1.1&quot;</span> <span class="na">id=</span><span class="s">&quot;Layer_1&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">x=</span><span class="s">&quot;0px&quot;</span> <span class="na">y=</span><span class="s">&quot;0px&quot;</span> <span class="na">width=</span><span class="s">&quot;800px&quot;</span> <span class="na">height=</span><span class="s">&quot;400px&quot;</span> <span class="na">viewBox=</span><span class="s">&quot;0 200 800 400&quot;</span> <span class="na">enable-background=</span><span class="s">&quot;new 0 200 800 400&quot;</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;g</span> <span class="na">id=</span><span class="s">&quot;Layer_2&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;g&gt;</span>
</span><span class='line'>    <span class="nt">&lt;g&gt;</span>
</span><span class='line'>      <span class="nt">&lt;path</span> <span class="na">fill=</span><span class="s">&quot;none&quot;</span> <span class="na">stroke=</span><span class="s">&quot;#E01F26&quot;</span> <span class="na">stroke-width=</span><span class="s">&quot;4&quot;</span> <span class="na">stroke-linecap=</span><span class="s">&quot;round&quot;</span> <span class="na">stroke-linejoin=</span><span class="s">&quot;round&quot;</span> <span class="na">d=</span><span class="s">&quot;M329.435,255.494</span>
</span><span class='line'><span class="s">        c125.977,108.275,37.064,167.75,73.58,263.252&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/g&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/g&gt;</span>
</span><span class='line'><span class="nt">&lt;/g&gt;</span>
</span><span class='line'><span class="nt">&lt;/svg&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>HTML/jQuery</h3>

<p>Paste your code into an html document with some spacing around it so you can scroll, then include jquery. Here&#8217;s the scrolling code:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//On scroll call the draw function</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scroll</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">drawLines</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//If you have more than one SVG per page this will pick it up</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">drawLines</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">drawLine</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">line</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//draw the line</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">drawLine</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">line</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">pathLength</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">distanceFromTop</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">percentDone</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nx">distanceFromTop</span> <span class="o">/</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">());</span>
</span><span class='line'>  <span class="nx">length</span> <span class="o">=</span> <span class="nx">percentDone</span> <span class="o">*</span> <span class="nx">pathLength</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">line</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="p">[</span><span class="nx">length</span><span class="p">,</span><span class="nx">pathLength</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;strokeDasharray: &quot;</span><span class="o">+</span><span class="p">[</span><span class="nx">length</span><span class="p">,</span><span class="nx">pathLength</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The basic idea in the drawLine() function is to calculate the percentage of distance the container is from the top of the viewport and then draw the line based on that percentage. The <code>line.style.strokeDasharray</code> is where the real magic happens.</p>

<p>Now everytime you scroll, the new height percentage is caluclated and that amount of the line is drawn onto the svg.</p>

<p>Tada!</p>

<p>From here its easy to play with the actual SVG code and change the colors or distance of the path.</p>

<h3>Resources</h3>

<p><a href="http://stackoverflow.com/a/14282391/552036">http://stackoverflow.com/questions/14275249/how-can-i-animate-a-progressive-drawing-of-svg-path</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reload page and add param on checkbox click with Rails]]></title>
    <link href="http://cbron.github.com/blog/2013/10/09/reload-page-and-add-param-on-checkbox-click-with-rails/"/>
    <updated>2013-10-09T10:03:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/10/09/reload-page-and-add-param-on-checkbox-click-with-rails</id>
    <content type="html"><![CDATA[

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">=</span> <span class="n">form_tag</span> <span class="n">the_current_path</span><span class="p">,</span> <span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:get</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">check_box_tag</span> <span class="ss">:my_filter</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:my_filter</span><span class="o">]</span><span class="p">,</span> <span class="ss">:onchange</span> <span class="o">=&gt;</span> <span class="s1">&#39;this.form.submit();&#39;</span><span class="err">&#39;</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">label_tag</span> <span class="ss">:my_filter</span><span class="p">,</span> <span class="s2">&quot;My Filter&quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[deploy via github on pull request merge]]></title>
    <link href="http://cbron.github.com/blog/2013/09/18/deploy-via-github-on-pull-request-merge/"/>
    <updated>2013-09-18T16:50:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/09/18/deploy-via-github-on-pull-request-merge</id>
    <content type="html"><![CDATA[<p><em>(This is only a concept, but I proved out all the parts seperately so they should work together)</em></p>

<p>The downside of github hooks is that right now the only one available through the web is when the repo receives a push. We wanted to have the repo update anytime anyone merges a pull request into the master branch.</p>

<p>I found this walkthrough which sets a repo up to pull from a normal github hook: <a href="https://gist.github.com/oodavid/1809044" target="_blank">https://gist.github.com/oodavid/1809044</a></p>

<p>So if you follow that entire guide but then switch out the &#8220;Set up service hook&#8221; piece for what I have below it should work.</p>

<h2>Setting up a hook on a pull request</h2>

<p>First go into github and click on account settings, then Applications and generate a personal access token.</p>

<p>Then using a rest client POST the following, you&#8217;ll need to setup a <a href="request%20bin">http://requestb.in/</a> to view the payload:</p>

<p><strong>URL</strong>:  https://api.github.com/repos/username/example_repo/hooks</p>

<p><strong>Header</strong>:
Authorization
token personal_access_token_XXXXXXXXXXXXXXXXXXXX</p>

<p><strong>Payload</strong>:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;active&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;events&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pull_request&quot;</span><span class="p">],</span>
</span><span class='line'>  <span class="nt">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://requestb.in/XXXXX&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using the &#8220;Advanced REST Client&#8221; extension in chrome it looks something like this:</p>

<p><img src="http://cbron.github.com/images/rest_client.png" /></p>

<p>Send that and you should get a success message.</p>

<p>Now do a pull request / merge inside github and check your request bin and you should have a huge payload in there.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">#This</span> <span class="err">is</span> <span class="err">just</span> <span class="err">a</span> <span class="err">piece</span> <span class="err">of</span> <span class="err">the</span> <span class="err">payload:</span>
</span><span class='line'><span class="err">payload:</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="s2">&quot;closed&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="nt">&quot;number&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
</span><span class='line'> <span class="nt">&quot;pull_request&quot;</span><span class="p">:</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>   <span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.github.com/repos/cbron/example_repo/pulls/2&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">8431554</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;html_url&quot;</span><span class="p">:</span><span class="s2">&quot;https://github.com/cbron/example_repo/pull/2&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;diff_url&quot;</span><span class="p">:</span><span class="s2">&quot;https://github.com/cbron/example_repo/pull/2.diff&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;patch_url&quot;</span><span class="p">:</span><span class="s2">&quot;https://github.com/cbron/example_repo/pull/2.patch&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;issue_url&quot;</span><span class="p">:</span><span class="s2">&quot;https://github.com/cbron/example_repo/pull/2&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;number&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;closed&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;testing merge hooks&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now going back to that walkthrough, inside your deploy.php page just check the payload for a state of &#8220;closed&#8221; and you can do a git pull. If the pull request was rejected the state will also be closed and this will still do a pull, but the app will simply be up to date so everythings kosher. You should also be able to check for which branch the pull request was on, but once again, pulling everytime a pull request is closed shouldn&#8217;t be a big deal.</p>

<p>This hook will now show up in Github under Settings -> Service Hooks -> WebHook URLS</p>

<p>Good luck!</p>

<h3>Resources</h3>

<ul>
<li>How to setup pull_request hook

<ul>
<li><a href="https://gist.github.com/bjhess/2726012">https://gist.github.com/bjhess/2726012</a></li>
</ul>
</li>
<li>Receive POST payload

<ul>
<li><a href="http://requestb.in/">http://requestb.in/</a></li>
</ul>
</li>
<li>Github API

<ul>
<li><a href="http://developer.github.com/guides/getting-started/">http://developer.github.com/guides/getting-started/</a></li>
</ul>
</li>
<li>Github Hooks Api

<ul>
<li><a href="http://developer.github.com/v3/repos/hooks/">http://developer.github.com/v3/repos/hooks/</a></li>
</ul>
</li>
<li>Deploy via hooks

<ul>
<li><a href="https://github.com/markomarkovic/simple-php-git-deploy">https://github.com/markomarkovic/simple-php-git-deploy</a></li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Devise constantly logging you out ?]]></title>
    <link href="http://cbron.github.com/blog/2013/07/12/devise-constantly-logging-you-out/"/>
    <updated>2013-07-12T10:47:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/07/12/devise-constantly-logging-you-out</id>
    <content type="html"><![CDATA[<h2>The problem</h2>

<p>I had a jquery mobile app living inside a rails app. I would login and move around the site a few times and suddenly I would be logged out. I was massively confused for a solid hour.</p>

<h2>What was happening</h2>

<p>I went digging around in Warden which Devise uses to handle sessions, then I remembered seeing this in my server logs:</p>

<pre><code>WARNING: Can't verify CSRF token authenticity
</code></pre>

<p>I did a little research and realized that my app was making multiple ajax requests while I was moving around. When rails can&#8217;t verify the CSRF token the first thing it does is kill all sessions, including Devise user sessions.</p>

<h2>How I fixed it</h2>

<p><a href="http://weblog.rubyonrails.org/2011/2/8/csrf-protection-bypass-in-ruby-on-rails/">I found this rails post</a>,
<a href="http://excid3.com/blog/rails-tip-2-include-csrf-token-with-every-ajax-request/#.UeA9lPZNYVd">and this blog post</a></p>

<p><a href="http://stackoverflow.com/questions/7203304/warning-cant-verify-csrf-token-authenticity-rails">This stack overflow question also goes into greater detail</a></p>

<p>In short, add this to your js somewhere in the header:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxSend</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;csrf-token&#39;]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;X-CSRF-Token&quot;</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>That will attach the correct csrf token along with your ajax requests. You should now no longer see the CSRF warning in your server logs.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dealing with duplicate assets in a staging environment when deploying with capistrano]]></title>
    <link href="http://cbron.github.com/blog/2013/06/04/duplicate-assets-on-a-staging-environment-with-capistrano/"/>
    <updated>2013-06-04T10:13:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/06/04/duplicate-assets-on-a-staging-environment-with-capistrano</id>
    <content type="html"><![CDATA[<p>When you use something like <code>$('#change_email_form').toggle(300);</code> and it gets included twice on the same page, everything doesn&#8217;t seem to work as expected&#8230;</p>

<p>I ran into this problem when setting up a staging environment using capistrano. My capfile had the usual <code>load 'deploy/assets'</code> which precompiles assets on both production and staging. And everything in
production worked fine, but staging not so much. After a few failed attemps I found a fix for the problem.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">compile</span> <span class="o">=</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby guides has this to say about assets.compile:</p>

<p><em>In some circumstances you may wish to use live compilation. In this mode all requests for assets in the pipeline are handled by Sprockets directly.
On the first request the assets are compiled and cached as outlined in development above, and the manifest names used in the helpers are altered to include the MD5 hash.</em></p>

<p>So basically capistrano was compiling the assets and throwing them in <code>public/assets</code> and at the same time Sprockets was trying to handle the requests by using the <code>app/assets</code> directory and all the javascript was included twice. In this case it was both in our <code>subscribe.js</code> and our <code>application.js</code>.</p>

<p>By setting <code>config.assets.compile = false</code> you tell Sprockets to stop attempting to serve your <code>app/assets</code> and solely use your public assets.</p>

<p>This is my final configuration for assets in config/environments/staging.rb</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Disable Rails&#39;s static asset server (Apache or nginx will already do this)</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="c1"># Don&#39;t fallback to assets pipeline if a precompiled asset is missed</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">compile</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="c1"># Generate digests for assets URLs</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">digest</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="c1"># Expands the lines which load the assets</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to tell if today is the first of the Week/Month/Year with ruby]]></title>
    <link href="http://cbron.github.com/blog/2013/02/20/how-to-tell-if-today-is-the-first-of-the-week-slash-month-slash-year-with-ruby/"/>
    <updated>2013-02-20T00:00:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/02/20/how-to-tell-if-today-is-the-first-of-the-week-slash-month-slash-year-with-ruby</id>
    <content type="html"><![CDATA[<p>I had a project recently where a cron would fire early in the morning and generate stats for the previous day/week/month/year. I needed to know when it fired if today was the beginning of a new month so I could generate last month&#8217;s stats.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#First hour of the day:</span>
</span><span class='line'><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Beginnning of the week</span>
</span><span class='line'><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">beginning_of_week</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">beginning_of_hour</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#First day of the month </span>
</span><span class='line'><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#First day of the year</span>
</span><span class='line'><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">beginning_of_year</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">beginning_of_hour</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install monit on CentOS 6 from source]]></title>
    <link href="http://cbron.github.com/blog/2013/01/12/install-monit-on-centos-6-from-source/"/>
    <updated>2013-01-12T15:01:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/01/12/install-monit-on-centos-6-from-source</id>
    <content type="html"><![CDATA[<h3>Resources</h3>

<p>Monit: <a href="http://mmonit.com/monit/">http://mmonit.com/monit/</a> <br/>
Wiki: <a href="http://mmonit.com/monit/documentation/monit.html">http://mmonit.com/monit/documentation/monit.html</a> <br/>
Man:  <a href="http://linux.die.net/man/1/monit">http://linux.die.net/man/1/monit</a></p>

<h3>Installation</h3>

<p>Other packes I needed for my box</p>

<pre><code>yum install pam-devel 
yum install openssl-devel
</code></pre>

<p>Get and install Monit</p>

<pre><code>cd /usr/local/src
wget http://mmonit.com/monit/dist/monit-5.5.tar.gz
tar -zxvf monit-5.5.tar.gz
cd monit-5.5
./configure (If this fails, fix as necessary, then re-unpack the tar and try again)
make
make install 
</code></pre>

<p>Setup monitrc</p>

<pre><code>cp monitrc /etc/
vi /etc/monitrc
  # At the end of monitrc add or uncomment: include /etc/monit.d/*
  # Also set the 'set daemon' line at the beginning to your preferred interval.
mkdir /etc/monit.d
</code></pre>

<p>Create the service files (this will repeat for every service you monitor)</p>

<pre><code>vi /etc/monit.d/apache

#Now Inside the apache file:

check process httpd with pidfile /var/run/httpd.pid
start program = "/etc/init.d/httpd start" with timeout 20 seconds
stop program = "/etc/init.d/httpd stop"
if failed host 127.0.0.1 port 80 protocol http
 and request "/index.html"
then restart
if 5 restarts within 5 cycles then timeout

check system localhost
if memory usage &gt; 85% then alert
if cpu usage (user) &gt; 80% for 3 cycles then alert
if cpu usage (system) &gt; 80% for 3 cycles then alert
</code></pre>

<p>To see more services, <a href="http://mmonit.com/wiki/Monit/ConfigurationExamples">check this out.</a></p>

<p>You can see in the above code we used alert. To setup alerts go into the /etc/monitrc file and do 2 things. First change the <code>set mailserver</code> line to localhost (or your mailserver). Then change the <code>set alert</code> line to include your email. Thats it.</p>

<p>Now setup the init.d file</p>

<pre><code>cp contrib/rc.monit /etc/init.d/monit
chmod 755 /etc/init.d/monit
</code></pre>

<p>You may need to fix the line inside the above file thats pointing at <code>/usr/bin/monit</code> to <code>/usr/local/bin/monit</code>.
After this is in place you should have the <code>service monit restart</code> command available.</p>

<p>To start Monit at boot, edit <code>vim /etc/rc.d/rc.local</code> and add in the next line</p>

<pre><code>/usr/local/bin/monit -c /etc/monitrc -p /var/run/monit.pid -l /var/log/monit.log
</code></pre>

<p>Go ahead and run the above line in the console to see if monit works. If so, a call to <code>service httpd stop</code> should cause monit to restart apache.</p>

<h3>Finished</h3>

<p>Monit should be all setup. You can check with <code>service monit status</code> or <code>ps aux | grep monit</code>.</p>

<p>Another cool feature of monit is the web interface. Go to <a href="http://localhost:2812/">http://localhost:2812/</a> and enter the username and password form your monitrc file, it should look something like this, feel free to change it:</p>

<pre><code>set httpd port 2812
  allow hauk:password
</code></pre>

<h3>Main Files</h3>

<pre><code>/etc/monitrc - Monit's control file

/etc/monit.d/* - all services Monit will track

/etc/init.d/monit - service control file

/usr/local/src/monit-5.5 - source code

/usr/local/bin/monit
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Delete non-unique hash values in ruby]]></title>
    <link href="http://cbron.github.com/blog/2013/01/12/delete-non-unique-hash-values-in-ruby/"/>
    <updated>2013-01-12T14:32:00-07:00</updated>
    <id>http://cbron.github.com/blog/2013/01/12/delete-non-unique-hash-values-in-ruby</id>
    <content type="html"><![CDATA[

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:cat</span> <span class="o">=&gt;</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="ss">:dog</span> <span class="o">=&gt;</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="ss">:fish</span> <span class="o">=&gt;</span> <span class="s2">&quot;dog&quot;</span><span class="p">}</span>
</span><span class='line'><span class="n">arr</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">each</span><span class="p">{</span><span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="n">arr</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">?</span> <span class="n">h</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">:</span> <span class="n">arr</span> <span class="err">«</span> <span class="n">val</span> <span class="p">}</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:cat</span><span class="o">=&gt;</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="ss">:dog</span><span class="o">=&gt;</span><span class="s2">&quot;dog&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
